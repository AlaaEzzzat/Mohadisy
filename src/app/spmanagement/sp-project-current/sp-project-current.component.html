<ng-container *ngIf="result==0">
  <div class="noresult mt-5">
    لا توجد نتائج عرض
  </div>
</ng-container>


<div class="section-2 mt-2 container-fluid">
  <div class="row">
    <div class="col-lg-3">
      <div class="row">
        <ng-container *ngFor="let project of Listprojects">
          <ng-container *ngIf="select==project.id">
            <div class="col-lg-12 card card-1 mt-4" (click)="showData(project.id)"
              style="background:#004958; color:white;">
              <p><i class="far fa-building "></i>
                <span> اسم المشروع :{{project.name}}
                  <a class="btn">(مشروع استشارى)</a>
                </span>
              </p>
              <p><i class="fa fa-location-dot "></i>
                العنوان: {{project.district?.nameAr}},{{project.district.city?.nameAr}},
                {{project.district.city.region?.nameAr}} </p>
              <p><i class="far fa-calendar-alt "></i>تاريخ التسليم:{{project.offers[0]?.deliveryDate}}</p>
            </div>
          </ng-container>


          <ng-container *ngIf="this.select!=project.id">
            <div class="col-lg-12 card card-1 mt-4" (click)="showData(project.id)"
              style="background:white;  color:#004057;">
              <p><i class="far fa-building "></i>
                <span> اسم المشروع :{{project?.name}}
                  <a class="btn">(مشروع استشارى)</a>
                </span>
              </p>
              <p><i class="fa fa-location-dot "></i>
                العنوان: {{project.district?.nameAr}},{{project.district?.city?.nameAr}},
                {{project.district?.city?.region?.nameAr}} </p>
              <p><i class="far fa-calendar-alt "></i>تاريخ التسليم:{{project.offers[0]?.deliveryDate}}</p>
            </div>
          </ng-container>

        </ng-container>


        <div class="col-lg-12">
          <nav aria-label="Page navigation" class="mt-4 mb-3" *ngIf="result==1">
            <ul class="pagination">
              <ng-container *ngIf="page==1">
                <li class="page-item disabled">
                  <button class="page-link btn p-1 px-3" tabindex="-1">السابق</button>
                </li>
              </ng-container>

              <ng-container *ngIf="page!=1">
                <li class="page-item">
                  <button class="page-link btn p-1 px-3" (click)="changepage(page-1)" tabindex="-1">السابق</button>
                </li>
              </ng-container>

              <ng-container *ngFor="let p of pages">
                <ng-container *ngIf="page==p">
                  <li class="page-item active"><button class="page-link btn p-1 px-3"
                      (click)="changepage(p)">{{p}}</button></li>
                </ng-container>

                <ng-container *ngIf="page!=p">
                  <li class="page-item"><button class="page-link btn p-1 px-3" (click)="changepage(p)">{{p}}</button>
                  </li>
                </ng-container>

              </ng-container>

              <ng-container *ngIf="page==pages.length">
                <li class="page-item disabled">
                  <button class="page-link btn p-1 px-3">التالى</button>
                </li>
              </ng-container>

              <ng-container *ngIf="page!=pages.length">
                <li class="page-item">
                  <button class="page-link btn p-1 px-3" (click)="changepage(page+1)">التالى</button>
                </li>
              </ng-container>

            </ul>
          </nav>
        </div>


      </div>

    </div>


    <!------------------------------------>

    <ng-container *ngIf="select!=0">
      <div class="col-lg-6 mt-4 mb-3 section-3">
        <div class="row">
          <div class="col-lg-12 info">
            <div class="card card-infoP">
              <div class="row">
                <div class="col-lg-3">
                  <img src="{{selectProject?.clientProfile?.profilePicturePath}}" alt="image">
                </div>

                <div class="col-lg-5  mt-4">
                  <p>{{selectProject?.clientProfile?.firstName}}
                    {{selectProject?.clientProfile?.lastName}}
                  </p>
                </div>

                <div class="col-lg-3 mt-4">
                  <p type="btn" (click)="toggleChat()" style="cursor:pointer;">
                    <i class="fa fa-commenting-o"></i>
                  </p>
                  <p style=" padding-right: 52%;">
                    مراسله
                  </p>
                </div>

                <!----------------chat--------------->
                <div class="overlay  p-5" *ngIf="startChat">
                  <div class="popup p-5">
                    <a class="close" style="cursor: pointer" (click)="toggleChat()">&times;</a>
                    <div class="content">
                      <label class="form-label fw-bold cairo">
                        الرساله
                      </label>
                      <div class="message-input d-flex flex-column justify-content-center">
                        <div class="wrap">
                          <input class="form-control" #textInput type="text" placeholder="اكتب شيئاً ..."
                            class="cairo" />
                          <i class="fa-solid fa-paperclip attachment" aria-hidden="true">

                            <input (change)="onFileUpload($event)" #fileImage type="file" alt="" name="attatch"
                              id="attatch" class="attatch" />
                            <small *ngIf="fileMessage" style="font-size: 12px;">{{
                              fileMessage.name.substr(0,12)}}...</small>

                          </i>
                        </div>
                        <button (click)="sendMessage(textInput.value)" class="btn submit">
                          <span>إرسال</span>
                          <i class="fa fa-paper-plane" aria-hidden="true"></i>
                        </button>
                      </div>
                    </div>
                  </div>
                </div>


                <!--------------end chat------------------->


              </div>
            </div>
          </div>
        </div>


        <div class="row">
          <div class="col-lg-4 mt-3">
            <div class="card card-2">
              <div class="row">
                <div class="col-lg-12 pt-4 px-4 pb-5 content-prec text-center">
                  <circle-progress [percent]="calcPrecentage" [radius]="50" [outerStrokeWidth]="10"
                    [innerStrokeWidth]="8" [outerStrokeColor]="'#18af9a'" [innerStrokeColor]="'#C7E596'"
                    [animation]="true" [animationDuration]="300" title="{{calcPrecentage.toFixed(2)}}%">
                  </circle-progress>
                  <p class="mt-3" *ngIf="calcPrecentage!=0">
                    تم الانتهاء {{calcPrecentage.toFixed(2)}}% من المراحل
                  </p>

                  <p class="mt-3" *ngIf="calcPrecentage==0">
                    {{statusStage}}
                  </p>

                </div>
              </div>
            </div>
          </div>

          <div class="col-lg-8 mt-2">
            <div class="row">

              <ng-container *ngFor="let stage of Allstages ; let i=index;">
                <div class="col-lg-12 mt-1">
                  <h2 class="card">
                    <button class="btn btn-accordion w-100 acc" type="button" (click)="toggleStage(stage.id)">
                      {{nameStage[i]}}
                      <i class="fas fa-angle-down"></i>
                    </button>
                  </h2>
                  <div class="card mt-2 card-2-1">
                    <div id="accordion">
                      <ng-container *ngIf="togglestage[stage.id]==1">
                        <div class="pt-3 pb-3 ">

                          <p>{{selectProject?.subject}}</p>

                          <div class="row mt-2 text-center">
                            <div class="col-lg-6 mt-2">
                              <a href="{{selectProject.clientProjectDocuments[0]?.filePath}}" target="_blank"><i
                                  class="fa fa-file-pdf-o" style="color:red; margin-left: 3%;"></i>اسم الملف</a>
                            </div>
                            <div class="col-lg-6 mt-2">
                              <a href=""><i class="fa-solid fa-image" style="color:green;"></i> صوره للموقع</a>
                            </div>

                            <div class="col-lg-12 px-2 mt-2" style="font-size:14px ;">
                              <div class="row">

                                <div class="col-lg-5">

                                  <button class="btn" type="button" (click)="finished(stage.id)"
                                    [disabled]="this.stagefinish[stage.id]==1">انهاء مرحله
                                  </button>


                                  <span style="margin-right: 15%;"> | </span>
                                </div>

                                <div class="col-lg-3">
                                  <button class="btn" type="button"
                                  data-bs-toggle="modal" data-bs-target="#open"
                                    [disabled]="stage.milestoneStatusId!=2">تعليق</button>

                                  <!------------Start Modal------------->
                                    <div class="fade modal  mt-5" aria-hidden="false" role="dialog" id="open">
                                      <div class="modal-dialog " >
                                        <div class="modal-content">
                                          <div class="modal-header">
                                            <button type="button" class="btn close "
                                            data-bs-dismiss="modal"
                                           >
                                              <i class="far fa-circle-xmark"></i>
                                            </button>
                                          </div>

                                          <form [formGroup]="Reason">
                                            <div class="modal-body">
                                              <h4>اكتب سبب التعليق</h4>

                                              <div class="form-group">
                                                <textarea class="form-control mt-3" formControlName="reason"></textarea>
                                              </div>

                                            </div>
                                            <div class="modal-footer">
                                              <button type="submit" class="btn"
                                              data-bs-dismiss="modal"
                                               (click)="pending(stage.id)">ارسال</button>
                                            </div>
                                          </form>

                                        </div>
                                      </div>


                                  </div>





                                  <!-------------End Modal-------------------->
                                </div>
                              </div>

                            </div>

                          </div>
                        </div>

                      </ng-container>

                    </div>

                  </div>

                </div>

              </ng-container>

            </div>

          </div>


        </div>


        <div class="row ">
          <div class="col-lg-12 mt-2">
            <div class="card card-2">
              <div class="row">
                <div class="col-lg-12 p-2 content-1">
                  <h6>نبذه عن المشروع</h6>
                  <p>{{selectProject?.subject}}
                  </p>
                </div>
              </div>
            </div>
          </div>


          <div class="col-lg-12 mt-2">
            <div class="card card-2">
              <div class="row">
                <div class="col-lg-12 p-2 content-2">
                  <p>صلاحيه عرض السعر: <span>{{selectProject.offers[0]?.period}}</span></p>
                  <p>التصنيف الرئيسى للمشروع: <span>{{selectProject.projectCategory?.name}}</span></p>
                  <p>التصنيف الفرعى للمشروع: <span>{{selectProject.projectSubCategory?.name}}</span></p>
                </div>
              </div>
            </div>
          </div>


          <div class="col-lg-12 mt-2">
            <div class="card card-2 ">
              <div class="row">
                <div class="col-lg-12 p-2 content-2">
                  <p>عنوان المشروع :
                    <span>{{selectProject.district?.nameAr}},{{selectProject.district?.city?.nameAr}},
                      {{selectProject.district?.city?.region?.nameAr}}</span>
                  </p>
                  <p>رقم القطعه : <span>{{selectProject?.plotNumber}}</span></p>
                  <p>رقم المخطط التنظيمى : <span>{{selectProject?.organizationalChartNumber}}</span></p>
                </div>
              </div>
            </div>
          </div>



          <div class="col-lg-12">
            <div class="row">
              <div class="col-lg-6 mt-3">
                <div class="row">
                  <div class="col-lg-12">
                    <div class="card card-3">
                      <h6>مكونات المشروع</h6>
                      <ul>
                        <ng-container *ngFor="let component of projectComponent">
                          <div>
                            <li>
                              <i class="fa fa-greater-than "></i>
                              {{component.name}}
                            </li>
                          </div>
                        </ng-container>

                      </ul>
                    </div>
                  </div>


                  <div class="col-lg-12 mt-3">
                    <div class="card card-3">
                      <h6>الملفات الخاصه بالمشروع</h6>
                      <ul>
                        <ng-container *ngFor=" let document of selectProject.clientProjectDocuments">

                          <li style="border:none; background-color:transparent;"
                            (click)="downloadFile(document.filePath,document.file)">
                            <i class="fa fa-download  mt-2" aria-hidden="true"></i>
                            {{document?.file.substring(0,25)}}..
                          </li>

                        </ng-container>
                      </ul>

                    </div>

                  </div>


                </div>
              </div>

              <div class="col-lg-6 mt-3">
                <div class="card card-3">
                  <h6>الاعمال المطلوبه</h6>
                  <ul>
                    <ng-container *ngFor="let work of this.RequiredWorks">
                      <div>
                        <li>
                          <i class="fa fa-greater-than "></i>
                          {{work.name}}
                        </li>
                      </div>
                    </ng-container>
                  </ul>
                </div>
              </div>





            </div>

          </div>




        </div>


      </div>



      <!-----------------Last Section ----------------------->
      <div class="col-lg-3 mt-4 mb-3 section-4">
        <div class="row ">
          <div class="col-lg-12">
            <div class="card card-4">
              <div class="row">
                <div class="col-lg-2 mt-1">
                  <img src="{{Representative?.organizationalServiceProviderProfile?.profilePicturePath}}" alt="image"
                    class="w-80">
                </div>
                <div class="col-lg-5 mt-3">
                  <p>
                    م : {{Representative?.firstName}} {{Representative?.lastName}}
                  </p>
                </div>
                <div class="col-lg-5 ">
                  <p class="mt-3" style="color:#18af9a; font-size: 10px;">(مسئول عن المشروع)</p>
                </div>

              </div>
            </div>
          </div>


          <div class="col-lg-12 mt-2">
            <div class="card card-4-1">
              <div class="row">
                <div class="col-lg-12 text-center">
                  <h2>{{selectProject.area}} <span>متر مربع</span></h2>
                  <p>مساحه الارض المقام عليها المشروع</p>
                </div>
              </div>
            </div>
          </div>


          <div class="col-lg-12 mt-2">
            <div class="card card-4-2">
              <div class="row">
                <div class="col-lg-9 text-center">
                  <h2>{{selectProject.offers[0]?.cost}}<span>ريال</span></h2>
                  <p>الميزانيه الخاصه بهذا المشروع</p>
                </div>
                <div class="col-lg-3">
                  <a href="">عرض</a>
                </div>

              </div>
            </div>
          </div>



          <div class="col-lg-12 mt-2">
            <div class="card card-date">
              <div class="row">
                <div class="col-lg-12 " class="calender">
                  <mat-calendar [(selected)]="selected"></mat-calendar>
                </div>
              </div>

            </div>
          </div>


          <div class="col-lg-12 mt-2">
            <div class="card card-4-4">
              <div class="row">
                <div class="col-lg-6 mt-2">
                  <h2>
                    {{selected |date:'mediumDate'}}
                  </h2>
                </div>
                <div class="col-lg-6">
                  <a class="btn">تعديل المحتوى</a>
                </div>

              </div>
            </div>
          </div>


          <div class="col-lg-12 mt-2">
            <div class="card card-4-5">
              <div class="row">
                <div class="col-lg-12">
                  <p>{{selectProject?.subject}}</p>
                </div>
                <div class="col-lg-12 mt-4">
                  <div class="row">
                    <div class="col-lg-6">
                      <a href="{{selectProject.clientProjectDocuments[0]?.filePath}}"><i class="fa fa-file-pdf-o"
                          style="color:red; font-size: 20px; margin-left: 3%;"></i>اسم الملف</a>
                    </div>
                    <div class="col-lg-6">
                      <a href=""><i class="fa-solid fa-image" style="color:green; font-size: 20px;"></i> صوره للموقع</a>
                    </div>

                  </div>
                </div>
              </div>
            </div>
          </div>



          <div class="col-lg-12 mt-2">
            <div class="card card-4-6">
              <a href="">رؤيه مسار العمل على المشروع</a>
            </div>
          </div>
        </div>




      </div>

    </ng-container>

  </div>

</div>
